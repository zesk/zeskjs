"use strict";

/**
 * Copyright &copy; 2017 Market Acumen, Inc.
 */
var $ = require("jquery");
var Zesk = require("./Zesk");

var is_object = Zesk.is_object;
var d = global.window.document;

var URL = function URL(mixed) {
	"use strict";

	var self = this;
	$.each(this.keys, function () {
		self[this] = null;
	});
	if (is_object(mixed)) {
		$.each(this.keys, function () {
			if (mixed[this]) {
				self[this] = mixed[this];
			}
		});
	} else if (Zesk.is_url(mixed)) {
		this.parse(mixed);
	} else if (Zesk.is_string(mixed)) {
		this.path = mixed;
	}
};
$.extend(URL.prototype, {
	keys: ["url", "scheme", "user", "pass", "host", "port", "path", "query", "hash"],
	_query: function _query(mixed) {
		if (mixed === undefined) {
			return this.query || null;
		}
		if (Zesk.is_string(mixed)) {
			if (mixed.charAt(0) !== "?") {
				mixed = "?" + mixed;
			}
		} else if (Zesk.is_object(mixed)) {
			var items = [];
			$.each(mixed, function (k) {
				if (this === null || this === undefined || this === "") {
					return;
				}
				items.push(encodeURIComponent(k) + "=" + encodeURIComponent(this));
			});
			mixed = "?" + items.join("&");
		}
		this.query = mixed;
		this.unparse();
		return this;
	},
	default_port: function default_port() {
		var ports = {
			http: 80,
			https: 443,
			ftp: 21
		};
		return ports[this.scheme] || null;
	},
	parse: function parse(url) {
		var parser = d.createElement("a");
		parser.href = url;
		this.url = url;
		this.scheme = String(parser.protocol).replace(/:$/, "");
		this.host = parser.hostname;
		this.port = parser.port;
		this.path = parser.pathname;
		this.query = parser.search;
		this.hash = parser.hash;
		return this;
	},
	unparse: function unparse() {
		var user = this.user ? this.user + (this.pass ? ":" + this.pass : "") + "@" : "";
		var port = this.port ? this.port === this.default_port() ? "" : ":" + this.port : "";
		var prefix = this.scheme ? this.scheme + ":" : "";
		var uhp = this.host ? "//" + user + this.host + port : "";
		this.url = prefix + uhp + this.path + this.query + (this.hash ? this.hash : "");
		return this.url;
	}
});
module.exports = URL;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9VUkwuanMiXSwibmFtZXMiOlsiJCIsInJlcXVpcmUiLCJaZXNrIiwiaXNfb2JqZWN0IiwiZCIsImdsb2JhbCIsIndpbmRvdyIsImRvY3VtZW50IiwiVVJMIiwibWl4ZWQiLCJzZWxmIiwiZWFjaCIsImtleXMiLCJpc191cmwiLCJwYXJzZSIsImlzX3N0cmluZyIsInBhdGgiLCJleHRlbmQiLCJwcm90b3R5cGUiLCJfcXVlcnkiLCJ1bmRlZmluZWQiLCJxdWVyeSIsImNoYXJBdCIsIml0ZW1zIiwiayIsInB1c2giLCJlbmNvZGVVUklDb21wb25lbnQiLCJqb2luIiwidW5wYXJzZSIsImRlZmF1bHRfcG9ydCIsInBvcnRzIiwiaHR0cCIsImh0dHBzIiwiZnRwIiwic2NoZW1lIiwidXJsIiwicGFyc2VyIiwiY3JlYXRlRWxlbWVudCIsImhyZWYiLCJTdHJpbmciLCJwcm90b2NvbCIsInJlcGxhY2UiLCJob3N0IiwiaG9zdG5hbWUiLCJwb3J0IiwicGF0aG5hbWUiLCJzZWFyY2giLCJoYXNoIiwidXNlciIsInBhc3MiLCJwcmVmaXgiLCJ1aHAiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOztBQUFBOzs7QUFHQSxJQUFNQSxJQUFJQyxRQUFRLFFBQVIsQ0FBVjtBQUNBLElBQU1DLE9BQU9ELFFBQVEsUUFBUixDQUFiOztBQUVBLElBQUlFLFlBQVlELEtBQUtDLFNBQXJCO0FBQ0EsSUFBSUMsSUFBSUMsT0FBT0MsTUFBUCxDQUFjQyxRQUF0Qjs7QUFFQSxJQUFJQyxNQUFNLFNBQU5BLEdBQU0sQ0FBU0MsS0FBVCxFQUFnQjtBQUN6Qjs7QUFDQSxLQUFJQyxPQUFPLElBQVg7QUFDQVYsR0FBRVcsSUFBRixDQUFPLEtBQUtDLElBQVosRUFBa0IsWUFBVztBQUM1QkYsT0FBSyxJQUFMLElBQWEsSUFBYjtBQUNBLEVBRkQ7QUFHQSxLQUFJUCxVQUFVTSxLQUFWLENBQUosRUFBc0I7QUFDckJULElBQUVXLElBQUYsQ0FBTyxLQUFLQyxJQUFa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QUFMLEtBQWMsS0FBS2YsWUFBTCxFQUFkLEdBQW9DLEVBQXBDLEdBQXlDLE1BQU0sS0FBS2UsSUFBakUsR0FBeUUsRUFBcEY7QUFDQSxNQUFJTSxTQUFTLEtBQUtoQixNQUFMLEdBQWMsS0FBS0EsTUFBTCxHQUFjLEdBQTVCLEdBQWtDLEVBQS9DO0FBQ0EsTUFBSWlCLE1BQU0sS0FBS1QsSUFBTCxHQUFZLE9BQU9NLElBQVAsR0FBYyxLQUFLTixJQUFuQixHQUEwQkUsSUFBdEMsR0FBNkMsRUFBdkQ7QUFDQSxPQUFLVCxHQUFMLEdBQVdlLFNBQVNDLEdBQVQsR0FBZSxLQUFLbkMsSUFBcEIsR0FBMkIsS0FBS0ssS0FBaEMsSUFBeUMsS0FBSzBCLElBQUwsR0FBWSxLQUFLQSxJQUFqQixHQUF3QixFQUFqRSxDQUFYO0FBQ0EsU0FBTyxLQUFLWixHQUFaO0FBQ0E7QUFuRHNCLENBQXhCO0FBcURBaUIsT0FBT0MsT0FBUCxHQUFpQjdDLEdBQWpCIiwiZmlsZSI6IlVSTC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0ICZjb3B5OyAyMDE3IE1hcmtldCBBY3VtZW4sIEluYy5cbiAqL1xuY29uc3QgJCA9IHJlcXVpcmUoXCJqcXVlcnlcIik7XG5jb25zdCBaZXNrID0gcmVxdWlyZShcIi4vWmVza1wiKTtcblxudmFyIGlzX29iamVjdCA9IFplc2suaXNfb2JqZWN0O1xudmFyIGQgPSBnbG9iYWwud2luZG93LmRvY3VtZW50O1xuXG52YXIgVVJMID0gZnVuY3Rpb24obWl4ZWQpIHtcblx0XCJ1c2Ugc3RyaWN0XCI7XG5cdHZhciBzZWxmID0gdGhpcztcblx0JC5lYWNoKHRoaXMua2V5cywgZnVuY3Rpb24oKSB7XG5cdFx0c2VsZlt0aGlzXSA9IG51bGw7XG5cdH0pO1xuXHRpZiAoaXNfb2JqZWN0KG1peGVkKSkge1xuXHRcdCQuZWFjaCh0aGlzLmtleXMsIGZ1bmN0aW9uKCkge1xuXHRcdFx0aWYgKG1peGVkW3RoaXNdKSB7XG5cdFx0XHRcdHNlbGZbdGhpc10gPSBtaXhlZFt0aGlzXTtcblx0XHRcdH1cblx0XHR9KTtcblx0fSBlbHNlIGlmIChaZXNrLmlzX3VybChtaXhlZCkpIHtcblx0XHR0aGlzLnBhcnNlKG1peGVkKTtcblx0fSBlbHNlIGlmIChaZXNrLmlzX3N0cmluZyhtaXhlZCkpIHtcblx0XHR0aGlzLnBhdGggPSBtaXhlZDtcblx0fVxufTtcbiQuZXh0ZW5kKFVSTC5wcm90b3R5cGUsIHtcblx0a2V5czogW1widXJsXCIsIFwic2NoZW1lXCIsIFwidXNlclwiLCBcInBhc3NcIiwgXCJob3N0XCIsIFwicG9ydFwiLCBcInBhdGhcIiwgXCJxdWVyeVwiLCBcImhhc2hcIl0sXG5cdF9xdWVyeTogZnVuY3Rpb24obWl4ZWQpIHtcblx0XHRpZiAobWl4ZWQgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0cmV0dXJuIHRoaXMucXVlcnkgfHwgbnVsbDtcblx0XHR9XG5cdFx0aWYgKFplc2suaXNfc3RyaW5nKG1peGVkKSkge1xuXHRcdFx0aWYgKG1peGVkLmNoYXJBdCgwKSAhPT0gXCI/XCIpIHtcblx0XHRcdFx0bWl4ZWQgPSBcIj9cIiArIG1peGVkO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSBpZiAoWmVzay5pc19vYmplY3QobWl4ZWQpKSB7XG5cdFx0XHR2YXIgaXRlbXMgPSBbXTtcblx0XHRcdCQuZWFjaChtaXhlZCwgZnVuY3Rpb24oaykge1xuXHRcdFx0XHRpZiAodGhpcyA9PT0gbnVsbCB8fCB0aGlzID09PSB1bmRlZmluZWQgfHwgdGhpcyA9PT0gXCJcIikge1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXHRcdFx0XHRpdGVtcy5wdXNoKGVuY29kZVVSSUNvbXBvbmVudChrKSArIFwiPVwiICsgZW5jb2RlVVJJQ29tcG9uZW50KHRoaXMpKTtcblx0XHRcdH0pO1xuXHRcdFx0bWl4ZWQgPSBcIj9cIiArIGl0ZW1zLmpvaW4oXCImXCIpO1xuXHRcdH1cblx0XHR0aGlzLnF1ZXJ5ID0gbWl4ZWQ7XG5cdFx0dGhpcy51bnBhcnNlKCk7XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH0sXG5cdGRlZmF1bHRfcG9ydDogZnVuY3Rpb24oKSB7XG5cdFx0dmFyIHBvcnRzID0ge1xuXHRcdFx0aHR0cDogODAsXG5cdFx0XHRodHRwczogNDQzLFxuXHRcdFx0ZnRwOiAyMSxcblx0XHR9O1xuXHRcdHJldHVybiBwb3J0c1t0aGlzLnNjaGVtZV0gfHwgbnVsbDtcblx0fSxcblx0cGFyc2U6IGZ1bmN0aW9uKHVybCkge1xuXHRcdHZhciBwYXJzZXIgPSBkLmNyZWF0ZUVsZW1lbnQoXCJhXCIpO1xuXHRcdHBhcnNlci5ocmVmID0gdXJsO1xuXHRcdHRoaXMudXJsID0gdXJsO1xuXHRcdHRoaXMuc2NoZW1lID0gU3RyaW5nKHBhcnNlci5wcm90b2NvbCkucmVwbGFjZSgvOiQvLCBcIlwiKTtcblx0XHR0aGlzLmhvc3QgPSBwYXJzZXIuaG9zdG5hbWU7XG5cdFx0dGhpcy5wb3J0ID0gcGFyc2VyLnBvcnQ7XG5cdFx0dGhpcy5wYXRoID0gcGFyc2VyLnBhdGhuYW1lO1xuXHRcdHRoaXMucXVlcnkgPSBwYXJzZXIuc2VhcmNoO1xuXHRcdHRoaXMuaGFzaCA9IHBhcnNlci5oYXNoO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9LFxuXHR1bnBhcnNlOiBmdW5jdGlvbigpIHtcblx0XHR2YXIgdXNlciA9IHRoaXMudXNlciA/IHRoaXMudXNlciArICh0aGlzLnBhc3MgPyBcIjpcIiArIHRoaXMucGFzcyA6IFwiXCIpICsgXCJAXCIgOiBcIlwiO1xuXHRcdHZhciBwb3J0ID0gdGhpcy5wb3J0ID8gKHRoaXMucG9ydCA9PT0gdGhpcy5kZWZhdWx0X3BvcnQoKSA/IFwiXCIgOiBcIjpcIiArIHRoaXMucG9ydCkgOiBcIlwiO1xuXHRcdHZhciBwcmVmaXggPSB0aGlzLnNjaGVtZSA/IHRoaXMuc2NoZW1lICsgXCI6XCIgOiBcIlwiO1xuXHRcdHZhciB1aHAgPSB0aGlzLmhvc3QgPyBcIi8vXCIgKyB1c2VyICsgdGhpcy5ob3N0ICsgcG9ydCA6IFwiXCI7XG5cdFx0dGhpcy51cmwgPSBwcmVmaXggKyB1aHAgKyB0aGlzLnBhdGggKyB0aGlzLnF1ZXJ5ICsgKHRoaXMuaGFzaCA/IHRoaXMuaGFzaCA6IFwiXCIpO1xuXHRcdHJldHVybiB0aGlzLnVybDtcblx0fSxcbn0pO1xubW9kdWxlLmV4cG9ydHMgPSBVUkw7XG4iXX0=