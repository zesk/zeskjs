"use strict";

/**
 * Copyright &copy; 2017 Market Acumen, Inc.
 */
var $ = require("jquery");
var zesk = require("./Zesk");

var avalue = zesk.avalue;
var is_object = zesk.is_object;
var is_string = zesk.is_string;
var _escape_map = {
	"&": "&amp;",
	"<": "&lt;",
	">": "&gt;",
	'"': "&quot;",
	"`": "&#96;",
	"'": "&#x27"
};
var _escape_map_flip;
var HTML = {
	specials: function specials(html) {
		return $("<textarea />").text(html).html();
	},
	escape: function escape(text) {
		return String(text).tr(_escape_map);
	},
	unescape: function unescape(text) {
		return String(text).tr(_escape_map_flip);
	},
	encode: function encode(text) {
		var result = document.createElement("a").appendChild(document.createTextNode(text)).parentNode.innerHTML;
		return result.str_replace('"', "&quot;");
	},
	decode: function decode(html) {
		var a = document.createElement("a");
		a.innerHTML = html;
		return a.textContent;
	},
	to_attributes: function to_attributes(mixed) {
		var obj = {};
		if (!is_string(mixed) || mixed.length === 0) {
			return arguments[1] || null;
		}
		$.each(mixed.split(" "), function () {
			var token = this.trim(),
			    c = token.substr(0, 1);
			if (c === "#") {
				obj.id = token;
				return;
			}
			if (c === ".") {
				token = token.substr(1);
			}
			if (obj["class"]) {
				obj["class"] += " " + token;
			} else {
				obj["class"] = token;
			}
		});
		return obj;
	},
	attributes: function attributes(_attributes) {
		var a,
		    r = [];
		if (!_attributes) {
			return "";
		}
		for (a in _attributes) {
			if (_attributes.hasOwnProperty(a)) {
				if (a.substr(0, 1) === "*") {
					r.push(a.substr(1) + '="' + _attributes[a] + '"');
				} else {
					r.push(a.toString() + '="' + HTML.encode(_attributes[a]) + '"');
				}
			}
		}
		if (r.length === 0) {
			return "";
		}
		return " " + r.join(" ");
	},
	tag: function tag(name, mixed) {
		var attributes,
		    content,
		    args = arguments;
		if (is_object(mixed)) {
			attributes = mixed;
			content = avalue(args, 2, null);
		} else if (args.length > 2) {
			attributes = HTML.to_attributes(mixed);
			content = args[2];
		} else {
			attributes = {};
			content = mixed;
		}
		name = name.toLowerCase();
		return "<" + name + " " + HTML.attributes(attributes) + (content === null ? " />" : ">" + content + "</" + name + ">");
	},
	tags: function tags(name, mixed) {
		var attributes,
		    content,
		    args = arguments,
		    result = "";
		if (is_object(mixed)) {
			attributes = mixed;
			content = avalue(args, 2, null);
		} else if (args.length > 2) {
			attributes = HTML.to_attributes(mixed);
			content = args[2];
		} else {
			attributes = {};
			content = mixed;
		}
		$.each(content, function () {
			result += HTML.tag(name, attributes, this);
		});
		return result;
	}
};

// Zesk.tag = function(name) {
// 	var a = arguments;
// 	if (a.length > 2) {
// 		return HTML.tag(name, a[1], a[2]);
// 	} else {
// 		return HTML.tag(name, a[1]);
// 	}
// };

module.exports = HTML;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9IVE1MLmpzIl0sIm5hbWVzIjpbIiQiLCJyZXF1aXJlIiwiemVzayIsImF2YWx1ZSIsImlzX29iamVjdCIsImlzX3N0cmluZyIsIl9lc2NhcGVfbWFwIiwiX2VzY2FwZV9tYXBfZmxpcCIsIkhUTUwiLCJzcGVjaWFscyIsImh0bWwiLCJ0ZXh0IiwiZXNjYXBlIiwiU3RyaW5nIiwidHIiLCJ1bmVzY2FwZSIsImVuY29kZSIsInJlc3VsdCIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImFwcGVuZENoaWxkIiwiY3JlYXRlVGV4dE5vZGUiLCJwYXJlbnROb2RlIiwiaW5uZXJIVE1MIiwic3RyX3JlcGxhY2UiLCJkZWNvZGUiLCJhIiwidGV4dENvbnRlbnQiLCJ0b19hdHRyaWJ1dGVzIiwibWl4ZWQiLCJvYmoiLCJsZW5ndGgiLCJhcmd1bWVudHMiLCJlYWNoIiwic3BsaXQiLCJ0b2tlbiIsInRyaW0iLCJjIiwic3Vic3RyIiwiaWQiLCJhdHRyaWJ1dGVzIiwiciIsImhhc093blByb3BlcnR5IiwicHVzaCIsInRvU3RyaW5nIiwiam9pbiIsInRhZyIsIm5hbWUiLCJjb250ZW50IiwiYXJncyIsInRvTG93ZXJDYXNlIiwidGFncyIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7O0FBQUE7OztBQUdBLElBQU1BLElBQUlDLFFBQVEsUUFBUixDQUFWO0FBQ0EsSUFBTUMsT0FBT0QsUUFBUSxRQUFSLENBQWI7O0FBRUEsSUFBSUUsU0FBU0QsS0FBS0MsTUFBbEI7QUFDQSxJQUFJQyxZQUFZRixLQUFLRSxTQUFyQjtBQUNBLElBQUlDLFlBQVlILEtBQUtHLFNBQXJCO0FBQ0EsSUFBSUMsY0FBYztBQUNqQixNQUFLLE9BRFk7QUFFakIsTUFBSyxNQUZZO0FBR2pCLE1BQUssTUFIWTtBQUlqQixNQUFLLFFBSlk7QUFLakIsTUFBSyxPQUxZO0FBTWpCLE1BQUs7QUFOWSxDQUFsQjtBQVFBLElBQUlDLGdCQUFKO0FBQ0EsSUFBSUMsT0FBTztB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QkMsS0FBbkIsQ0FBYjtBQUNBbUIsYUFBVUMsS0FBSyxDQUFMLENBQVY7QUFDQSxHQUhNLE1BR0E7QUFDTlQsZ0JBQWEsRUFBYjtBQUNBUSxhQUFVbkIsS0FBVjtBQUNBO0FBQ0Q3QixJQUFFaUMsSUFBRixDQUFPZSxPQUFQLEVBQWdCLFlBQVc7QUFDMUIvQixhQUFVVCxLQUFLc0MsR0FBTCxDQUFTQyxJQUFULEVBQWVQLFVBQWYsRUFBMkIsSUFBM0IsQ0FBVjtBQUNBLEdBRkQ7QUFHQSxTQUFPdkIsTUFBUDtBQUNBO0FBMUdTLENBQVg7O0FBNkdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUFtQyxPQUFPQyxPQUFQLEdBQWlCN0MsSUFBakIiLCJmaWxlIjoiSFRNTC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0ICZjb3B5OyAyMDE3IE1hcmtldCBBY3VtZW4sIEluYy5cbiAqL1xuY29uc3QgJCA9IHJlcXVpcmUoXCJqcXVlcnlcIik7XG5jb25zdCB6ZXNrID0gcmVxdWlyZShcIi4vWmVza1wiKTtcblxudmFyIGF2YWx1ZSA9IHplc2suYXZhbHVlO1xudmFyIGlzX29iamVjdCA9IHplc2suaXNfb2JqZWN0O1xudmFyIGlzX3N0cmluZyA9IHplc2suaXNfc3RyaW5nO1xudmFyIF9lc2NhcGVfbWFwID0ge1xuXHRcIiZcIjogXCImYW1wO1wiLFxuXHRcIjxcIjogXCImbHQ7XCIsXG5cdFwiPlwiOiBcIiZndDtcIixcblx0J1wiJzogXCImcXVvdDtcIixcblx0XCJgXCI6IFwiJiM5NjtcIixcblx0XCInXCI6IFwiJiN4MjdcIixcbn07XG52YXIgX2VzY2FwZV9tYXBfZmxpcDtcbnZhciBIVE1MID0ge1xuXHRzcGVjaWFsczogZnVuY3Rpb24oaHRtbCkge1xuXHRcdHJldHVybiAkKFwiPHRleHRhcmVhIC8+XCIpXG5cdFx0XHQudGV4dChodG1sKVxuXHRcdFx0Lmh0bWwoKTtcblx0fSxcblx0ZXNjYXBlOiBmdW5jdGlvbih0ZXh0KSB7XG5cdFx0cmV0dXJuIFN0cmluZyh0ZXh0KS50cihfZXNjYXBlX21hcCk7XG5cdH0sXG5cdHVuZXNjYXBlOiBmdW5jdGlvbih0ZXh0KSB7XG5cdFx0cmV0dXJuIFN0cmluZyh0ZXh0KS50cihfZXNjYXBlX21hcF9mbGlwKTtcblx0fSxcblx0ZW5jb2RlOiBmdW5jdGlvbih0ZXh0KSB7XG5cdFx0dmFyIHJlc3VsdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHRleHQpKS5wYXJlbnROb2RlLmlubmVySFRNTDtcblx0XHRyZXR1cm4gcmVzdWx0LnN0cl9yZXBsYWNlKCdcIicsIFwiJnF1b3Q7XCIpO1xuXHR9LFxuXHRkZWNvZGU6IGZ1bmN0aW9uKGh0bWwpIHtcblx0XHR2YXIgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpO1xuXHRcdGEuaW5uZXJIVE1MID0gaHRtbDtcblx0XHRyZXR1cm4gYS50ZXh0Q29udGVudDtcblx0fSxcblx0dG9fYXR0cmlidXRlczogZnVuY3Rpb24obWl4ZWQpIHtcblx0XHR2YXIgb2JqID0ge307XG5cdFx0aWYgKCFpc19zdHJpbmcobWl4ZWQpIHx8IG1peGVkLmxlbmd0aCA9PT0gMCkge1xuXHRcdFx0cmV0dXJuIGFyZ3VtZW50c1sxXSB8fCBudWxsO1xuXHRcdH1cblx0XHQkLmVhY2gobWl4ZWQuc3BsaXQoXCIgXCIpLCBmdW5jdGlvbigpIHtcblx0XHRcdHZhciB0b2tlbiA9IHRoaXMudHJpbSgpLFxuXHRcdFx0XHRjID0gdG9rZW4uc3Vic3RyKDAsIDEpO1xuXHRcdFx0aWYgKGMgPT09IFwiI1wiKSB7XG5cdFx0XHRcdG9iai5pZCA9IHRva2VuO1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cdFx0XHRpZiAoYyA9PT0gXCIuXCIpIHtcblx0XHRcdFx0dG9rZW4gPSB0b2tlbi5zdWJzdHIoMSk7XG5cdFx0XHR9XG5cdFx0XHRpZiAob2JqW1wiY2xhc3NcIl0pIHtcblx0XHRcdFx0b2JqW1wiY2xhc3NcIl0gKz0gXCIgXCIgKyB0b2tlbjtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdG9ialtcImNsYXNzXCJdID0gdG9rZW47XG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0cmV0dXJuIG9iajtcblx0fSxcblx0YXR0cmlidXRlczogZnVuY3Rpb24oYXR0cmlidXRlcykge1xuXHRcdHZhciBhLFxuXHRcdFx0ciA9IFtdO1xuXHRcdGlmICghYXR0cmlidXRlcykge1xuXHRcdFx0cmV0dXJuIFwiXCI7XG5cdFx0fVxuXHRcdGZvciAoYSBpbiBhdHRyaWJ1dGVzKSB7XG5cdFx0XHRpZiAoYXR0cmlidXRlcy5oYXNPd25Qcm9wZXJ0eShhKSkge1xuXHRcdFx0XHRpZiAoYS5zdWJzdHIoMCwgMSkgPT09IFwiKlwiKSB7XG5cdFx0XHRcdFx0ci5wdXNoKGEuc3Vic3RyKDEpICsgJz1cIicgKyBhdHRyaWJ1dGVzW2FdICsgJ1wiJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0ci5wdXNoKGEudG9TdHJpbmcoKSArICc9XCInICsgSFRNTC5lbmNvZGUoYXR0cmlidXRlc1thXSkgKyAnXCInKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoci5sZW5ndGggPT09IDApIHtcblx0XHRcdHJldHVybiBcIlwiO1xuXHRcdH1cblx0XHRyZXR1cm4gXCIgXCIgKyByLmpvaW4oXCIgXCIpO1xuXHR9LFxuXHR0YWc6IGZ1bmN0aW9uKG5hbWUsIG1peGVkKSB7XG5cdFx0dmFyIGF0dHJpYnV0ZXMsXG5cdFx0XHRjb250ZW50LFxuXHRcdFx0YXJncyA9IGFyZ3VtZW50cztcblx0XHRpZiAoaXNfb2JqZWN0KG1peGVkKSkge1xuXHRcdFx0YXR0cmlidXRlcyA9IG1peGVkO1xuXHRcdFx0Y29udGVudCA9IGF2YWx1ZShhcmdzLCAyLCBudWxsKTtcblx0XHR9IGVsc2UgaWYgKGFyZ3MubGVuZ3RoID4gMikge1xuXHRcdFx0YXR0cmlidXRlcyA9IEhUTUwudG9fYXR0cmlidXRlcyhtaXhlZCk7XG5cdFx0XHRjb250ZW50ID0gYXJnc1syXTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0YXR0cmlidXRlcyA9IHt9O1xuXHRcdFx0Y29udGVudCA9IG1peGVkO1xuXHRcdH1cblx0XHRuYW1lID0gbmFtZS50b0xvd2VyQ2FzZSgpO1xuXHRcdHJldHVybiAoXG5cdFx0XHRcIjxcIiArXG5cdFx0XHRuYW1lICtcblx0XHRcdFwiIFwiICtcblx0XHRcdEhUTUwuYXR0cmlidXRlcyhhdHRyaWJ1dGVzKSArXG5cdFx0XHQoY29udGVudCA9PT0gbnVsbCA/IFwiIC8+XCIgOiBcIj5cIiArIGNvbnRlbnQgKyBcIjwvXCIgKyBuYW1lICsgXCI+XCIpXG5cdFx0KTtcblx0fSxcblx0dGFnczogZnVuY3Rpb24obmFtZSwgbWl4ZWQpIHtcblx0XHR2YXIgYXR0cmlidXRlcyxcblx0XHRcdGNvbnRlbnQsXG5cdFx0XHRhcmdzID0gYXJndW1lbnRzLFxuXHRcdFx0cmVzdWx0ID0gXCJcIjtcblx0XHRpZiAoaXNfb2JqZWN0KG1peGVkKSkge1xuXHRcdFx0YXR0cmlidXRlcyA9IG1peGVkO1xuXHRcdFx0Y29udGVudCA9IGF2YWx1ZShhcmdzLCAyLCBudWxsKTtcblx0XHR9IGVsc2UgaWYgKGFyZ3MubGVuZ3RoID4gMikge1xuXHRcdFx0YXR0cmlidXRlcyA9IEhUTUwudG9fYXR0cmlidXRlcyhtaXhlZCk7XG5cdFx0XHRjb250ZW50ID0gYXJnc1syXTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0YXR0cmlidXRlcyA9IHt9O1xuXHRcdFx0Y29udGVudCA9IG1peGVkO1xuXHRcdH1cblx0XHQkLmVhY2goY29udGVudCwgZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXN1bHQgKz0gSFRNTC50YWcobmFtZSwgYXR0cmlidXRlcywgdGhpcyk7XG5cdFx0fSk7XG5cdFx0cmV0dXJuIHJlc3VsdDtcblx0fSxcbn07XG5cbi8vIFplc2sudGFnID0gZnVuY3Rpb24obmFtZSkge1xuLy8gXHR2YXIgYSA9IGFyZ3VtZW50cztcbi8vIFx0aWYgKGEubGVuZ3RoID4gMikge1xuLy8gXHRcdHJldHVybiBIVE1MLnRhZyhuYW1lLCBhWzFdLCBhWzJdKTtcbi8vIFx0fSBlbHNlIHtcbi8vIFx0XHRyZXR1cm4gSFRNTC50YWcobmFtZSwgYVsxXSk7XG4vLyBcdH1cbi8vIH07XG5cbm1vZHVsZS5leHBvcnRzID0gSFRNTDtcbiJdfQ==